[![Rust](https://img.shields.io/badge/rust-1.75%2B-orange?logo=rust)](https://www.rust-lang.org)
[![Actix Web](https://img.shields.io/badge/actix--web-4.0-blue)](https://actix.rs)
[![PostgreSQL](https://img.shields.io/badge/postgres-16-blue?logo=postgresql)](https://www.postgresql.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)]()
[![Stars](https://img.shields.io/github/stars/digkill/Sora2WatermarkRemove?style=social)]()
[![Forks](https://img.shields.io/github/forks/digkill/Sora2WatermarkRemove?style=social)]()

# Sora2WatermarkRemove
**Remove watermarks from Sora-generated videos automatically**

A full-featured backend service built with **Rust** and **Actix Web** that allows users to upload videos generated by OpenAI Sora, automatically remove watermarks using the Kie.ai API, and receive a clean video stored in Amazon S3.

Includes user authentication, credit-based billing, one-time packs, monthly subscriptions, payment integration (Lava.top), PostgreSQL database, and secure JWT-based authorization.

## Features

- User registration & login (email + password)
- JWT authentication
- 1 free watermark removal on signup
- One-time credit packs and recurring monthly subscriptions (in USD)
- Automatic monthly quota reset for subscriptions
- Video upload → S3 storage → Kie.ai watermark removal (async with callback)
- Clean video saved to S3 with public URL
- Webhook handling for payment confirmation and processing results
- Full billing history and subscription management
- Secure, scalable, production-ready architecture

## Tech Stack

- **Rust** + **Actix Web** – high-performance backend
- **PostgreSQL** + **sqlx** – database with migrations
- **Amazon S3** – storage for original and cleaned videos
- **Kie.ai API** – Sora watermark removal
- **Lava.top** – payment processing (supports recurring)
- **JWT** – authentication
- **dotenv** – environment configuration

## Project Structure
.
├── migrations/             # SQLx database migrations
├── src/
│   ├── main.rs             # Entry point & server setup
│   ├── billing.rs          # Credit/quota logic
│   ├── api/
│   │   ├── auth.rs         # Register / login
│   │   ├── handlers.rs     # Upload & user endpoints
│   │   ├── payments.rs     # Payment creation
│   │   └── webhooks.rs     # Lava & Kie.ai callbacks
│   └── db.rs               # Models & queries
├── .env.example            # Example environment variables
├── Cargo.toml
└── README.md
text## Quick Start

### 1. Clone the repository

```bash
git clone https://github.com/digkill/Sora2WatermarkRemove.git
cd Sora2WatermarkRemove
```

### 2. Set up environment variables
Copy the example and fill in your values:
Bashcp .env.example .env
Required variables in .env:
envDATABASE_URL=postgres://user:password@localhost:5432/sora_watermark
KIE_API_KEY=your_kie_ai_api_key
S3_BUCKET=your-s3-bucket-name
CALLBACK_BASE_URL=https://your-domain.com

# AWS (can use IAM role on EC2)
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_REGION=us-east-1

# Lava.top
LAVA_PROJECT_ID=your_project_id
LAVA_SECRET_KEY=your_secret_key

# JWT
JWT_SECRET=strong-random-secret-here

### 3. Run PostgreSQL
Using Docker (recommended):
Bashdocker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_USER=user \
  -e POSTGRES_DB=sora_watermark \
  -p 5432:5432 \
  postgres:16

### 4. Run migrations
Bashcargo install sqlx-cli --no-default-features --features rustls,postgres
sqlx migrate run

### 5. Start the server
Bashcargo run
Server will be available at http://localhost:8065
API Endpoints


MethodEndpointDescriptionAuth
POST /auth/registerRegister new userNo
POST /auth/loginLogin & get JWTNo
POST /api/uploadUpload video (uses credit/quota)Yes
GET /api/productsList available packs/subscriptionsYes
POST /api/create-paymentCreate payment link (Lava.top)Yes
GET /api/subscriptionsList user's subscriptionsYes
POST /api/subscriptions/cancelCancel subscriptionYes
POST /webhook/lavaLava payment webhook (public)No
POST /api/watermark-callbackKie.ai processing result webhookNo
Security Notes

Never commit .env to version control
Use strong JWT_SECRET
Enable HTTPS in production (e.g., via Nginx + Let's Encrypt)
S3 bucket should allow public reads for cleaned videos (or use signed URLs)

Contributing
Contributions are welcome! Feel free to open issues or PRs.


License
MIT License
